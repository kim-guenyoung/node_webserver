openapi: 3.0.0
info:
  title: School Attendance Management System API
  description: |
    학교 출석 관리 시스템 API
    
    **3가지 사용자 역할:**
    - Admin: 시스템 관리자 (학과/학기/과목 관리, 시스템 설정, 리포트)
    - Instructor: 교원 (강의 일정, 출석 관리, 공결 승인, 알림 발송)
    - Student: 수강생 (출석 체크, 공결 신청, 메시지)
    
    **핵심 기능:**
    1. 수업/강의 관리
    2. 출석 관리 (2가지 이상 방식)
    3. 공결/사유 처리
    4. 정정/이의제기
    5. 알림/커뮤니케이션
    6. 감사/보안 로그
    
  version: 1.0.0
  contact:
    name: Development Team
    email: dev@school.ac.kr

servers:
  - url: http://localhost:3000/api/v1
    description: Local development server
  - url: https://api.school.ac.kr/v1
    description: Production server

tags:
  - name: Authentication
    description: 인증 관련 API
  - name: Users
    description: 사용자 관리
  - name: Departments
    description: 학과 관리 (Admin)
  - name: Semesters
    description: 학기 관리 (Admin)
  - name: Courses
    description: 과목/강의 관리
  - name: Class Sessions
    description: 강의 세션 관리
  - name: Enrollments
    description: 수강신청 관리
  - name: Attendance
    description: 출석 관리
  - name: Excuse Requests
    description: 공결 신청 관리
  - name: Attendance Appeals
    description: 출석 이의제기/정정
  - name: Messages
    description: 메시지/커뮤니케이션
  - name: Notifications
    description: 푸시 알림
  - name: Polls
    description: 투표 (공강 투표)
  - name: Audit Logs
    description: 감사 로그
  - name: Reports
    description: 리포트/통계

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: session_token
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # ========== User Related ==========
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          maxLength: 100
        email:
          type: string
          format: email
          maxLength: 200
        password_hash:
          type: string
          maxLength: 255
        role:
          type: string
          enum: [admin, instructor, student]
        department_id:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        last_login_at:
          type: string
          format: date-time
          nullable: true

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password

    LoginResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: '#/components/schemas/User'
        message:
          type: string

    # ========== Department ==========
    Department:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          maxLength: 100
        code:
          type: string
          maxLength: 20
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DepartmentInput:
      type: object
      required:
        - name
        - code
      properties:
        name:
          type: string
          maxLength: 100
        code:
          type: string
          maxLength: 20

    # ========== Semester ==========
    Semester:
      type: object
      properties:
        id:
          type: integer
        year:
          type: integer
        term:
          type: string
          maxLength: 20
          example: "2학기"
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SemesterInput:
      type: object
      required:
        - year
        - term
        - start_date
        - end_date
      properties:
        year:
          type: integer
          example: 2025
        term:
          type: string
          example: "2학기"
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date

    # ========== Course ==========
    Course:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
          maxLength: 200
        code:
          type: string
          maxLength: 50
        department_id:
          type: integer
        semester_id:
          type: integer
        instructor_id:
          type: integer
        grade:
          type: integer
          description: "학년 (1~4)"
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CourseInput:
      type: object
      required:
        - title
        - code
        - department_id
        - semester_id
        - instructor_id
        - grade
      properties:
        title:
          type: string
        code:
          type: string
        department_id:
          type: integer
        semester_id:
          type: integer
        instructor_id:
          type: integer
        grade:
          type: integer
          minimum: 1
          maximum: 4
        is_active:
          type: boolean
          default: true

    # ========== Class Session ==========
    ClassSession:
      type: object
      properties:
        id:
          type: integer
        course_id:
          type: integer
        week:
          type: integer
          description: "주차 (1~16)"
        date:
          type: string
          format: date
        start_time:
          type: string
          format: time
        end_time:
          type: string
          format: time
        room:
          type: string
          maxLength: 100
          nullable: true
        attendance_method_id:
          type: integer
          nullable: true
        is_canceled:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ClassSessionInput:
      type: object
      required:
        - course_id
        - week
        - date
        - start_time
        - end_time
      properties:
        course_id:
          type: integer
        week:
          type: integer
        date:
          type: string
          format: date
        start_time:
          type: string
          format: time
        end_time:
          type: string
          format: time
        room:
          type: string
        attendance_method_id:
          type: integer
        is_canceled:
          type: boolean
          default: false

    # ========== Enrollment ==========
    Enrollment:
      type: object
      properties:
        id:
          type: integer
        course_id:
          type: integer
        student_id:
          type: integer
        status:
          type: string
          enum: [enrolled, dropped, completed]
        created_at:
          type: string
          format: date-time

    EnrollmentInput:
      type: object
      required:
        - course_id
        - student_id
      properties:
        course_id:
          type: integer
        student_id:
          type: integer

    # ========== Attendance ==========
    AttendanceMethod:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          maxLength: 50
          example: "전자출결"
        description:
          type: string
          maxLength: 255

    AttendanceStatusCode:
      type: object
      properties:
        code:
          type: integer
          enum: [0, 1, 2, 3, 4]
          description: "0:미정, 1:출석, 2:지각, 3:결석, 4:공결"
        name:
          type: string
          maxLength: 50

    Attendance:
      type: object
      properties:
        id:
          type: integer
        session_id:
          type: integer
        student_id:
          type: integer
        status_code:
          type: integer
          enum: [0, 1, 2, 3, 4]
        method_id:
          type: integer
          nullable: true
        checked_at:
          type: string
          format: date-time
          nullable: true
        instructor_id:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        is_changed:
          type: boolean
          description: "정정 여부"

    AttendanceCheckRequest:
      type: object
      required:
        - session_id
      properties:
        session_id:
          type: integer
        verification_code:
          type: string
          description: "인증번호 방식인 경우"

    AttendanceUpdateRequest:
      type: object
      required:
        - status_code
      properties:
        status_code:
          type: integer
          enum: [0, 1, 2, 3, 4]
        reason:
          type: string
          description: "변경 사유 (정정 시)"

    # ========== Excuse Request ==========
    ExcuseRequest:
      type: object
      properties:
        id:
          type: integer
        session_id:
          type: integer
        student_id:
          type: integer
        reason_text:
          type: string
        status:
          type: string
          enum: [pending, approved, rejected]
        teacher_comment:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        decided_at:
          type: string
          format: date-time
          nullable: true
        file_id:
          type: integer
          nullable: true

    ExcuseRequestInput:
      type: object
      required:
        - session_id
        - reason_text
      properties:
        session_id:
          type: integer
        reason_text:
          type: string

    ExcuseRequestDecision:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [approved, rejected]
        teacher_comment:
          type: string

    # ========== File ==========
    File:
      type: object
      properties:
        id:
          type: integer
        uploader_id:
          type: integer
        original_name:
          type: string
          maxLength: 255
        path:
          type: string
          maxLength: 500
        mime_type:
          type: string
          maxLength: 100
        size:
          type: integer
        created_at:
          type: string
          format: date-time

    # ========== Attendance Appeal ==========
    AttendanceAppeal:
      type: object
      properties:
        id:
          type: integer
        attendance_id:
          type: integer
        student_id:
          type: integer
        reason_text:
          type: string
        status:
          type: string
          enum: [pending, approved, rejected]
        teacher_comment:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        decided_at:
          type: string
          format: date-time
          nullable: true

    AttendanceAppealInput:
      type: object
      required:
        - attendance_id
        - reason_text
      properties:
        attendance_id:
          type: integer
        reason_text:
          type: string

    # ========== Message ==========
    Message:
      type: object
      properties:
        id:
          type: integer
        from_user_id:
          type: integer
        to_user_id:
          type: integer
          nullable: true
        course_id:
          type: integer
          nullable: true
        content:
          type: string
        created_at:
          type: string
          format: date-time
        is_read:
          type: boolean
        read_at:
          type: string
          format: date-time
          nullable: true

    MessageInput:
      type: object
      required:
        - content
      properties:
        to_user_id:
          type: integer
          description: "개인 메시지인 경우"
        course_id:
          type: integer
          description: "전체 공지인 경우"
        content:
          type: string

    # ========== Notification ==========
    Notification:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        type:
          type: string
          maxLength: 50
          enum: 
            - attendance_open
            - attendance_close
            - excuse_result
            - course_announcement
            - poll_created
            - absence_warning
        title:
          type: string
          maxLength: 200
        message:
          type: string
        created_at:
          type: string
          format: date-time
        related_course_id:
          type: integer
          nullable: true
        related_session_id:
          type: integer
          nullable: true
        is_read:
          type: boolean
        read_at:
          type: string
          format: date-time
          nullable: true

    # ========== Poll ==========
    Poll:
      type: object
      properties:
        id:
          type: integer
        course_id:
          type: integer
        session_id:
          type: integer
        title:
          type: string
          maxLength: 200
        description:
          type: string
        status:
          type: string
          enum: [active, closed]
        created_by:
          type: integer
        created_at:
          type: string
          format: date-time
        closed_at:
          type: string
          format: date-time
          nullable: true

    PollInput:
      type: object
      required:
        - course_id
        - session_id
        - title
      properties:
        course_id:
          type: integer
        session_id:
          type: integer
        title:
          type: string
        description:
          type: string

    PollVote:
      type: object
      properties:
        id:
          type: integer
        poll_id:
          type: integer
        student_id:
          type: integer
        choice:
          type: string
          enum: [yes, no]
        created_at:
          type: string
          format: date-time

    PollVoteInput:
      type: object
      required:
        - choice
      properties:
        choice:
          type: string
          enum: [yes, no]

    # ========== Audit Log ==========
    AuditLog:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        action:
          type: string
          maxLength: 100
          example: "attendance_changed"
        target_type:
          type: string
          maxLength: 50
          example: "attendance"
        target_id:
          type: integer
        before_value:
          type: object
        after_value:
          type: object
        ip_address:
          type: string
          maxLength: 45
        created_at:
          type: string
          format: date-time

    # ========== Common Response ==========
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
        error:
          type: string
        message:
          type: string

    PaginatedResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            type: object
        pagination:
          type: object
          properties:
            total:
              type: integer
            page:
              type: integer
            limit:
              type: integer
            totalPages:
              type: integer

paths:
  # ========== Authentication ==========
  /auth/login:
    post:
      tags:
        - Authentication
      summary: 로그인
      description: 이메일과 비밀번호로 로그인하고 JWT 토큰 및 쿠키를 발급받습니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 로그인 성공
          headers:
            Set-Cookie:
              schema:
                type: string
                example: session_token=abcde12345; Path=/; HttpOnly
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: 로그아웃
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 로그아웃 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /auth/me:
    get:
      tags:
        - Authentication
      summary: 현재 로그인한 사용자 정보
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 사용자 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'

  # ========== Users ==========
  /users:
    get:
      tags:
        - Users
      summary: 사용자 목록 조회 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: role
          schema:
            type: string
            enum: [admin, instructor, student]
        - in: query
          name: department_id
          schema:
            type: integer
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: 사용자 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'

    post:
      tags:
        - Users
      summary: 사용자 생성 (Admin)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: 사용자 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /users/{id}:
    get:
      tags:
        - Users
      summary: 사용자 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 사용자 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'

    put:
      tags:
        - Users
      summary: 사용자 정보 수정
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    delete:
      tags:
        - Users
      summary: 사용자 삭제 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Departments ==========
  /departments:
    get:
      tags:
        - Departments
      summary: 학과 목록 조회
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 학과 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  departments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Department'

    post:
      tags:
        - Departments
      summary: 학과 생성 (Admin)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DepartmentInput'
      responses:
        '201':
          description: 학과 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /departments/{id}:
    get:
      tags:
        - Departments
      summary: 학과 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 학과 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  department:
                    $ref: '#/components/schemas/Department'

    put:
      tags:
        - Departments
      summary: 학과 수정 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DepartmentInput'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    delete:
      tags:
        - Departments
      summary: 학과 삭제 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Semesters ==========
  /semesters:
    get:
      tags:
        - Semesters
      summary: 학기 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: year
          schema:
            type: integer
      responses:
        '200':
          description: 학기 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  semesters:
                    type: array
                    items:
                      $ref: '#/components/schemas/Semester'

    post:
      tags:
        - Semesters
      summary: 학기 생성 (Admin)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SemesterInput'
      responses:
        '201':
          description: 학기 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /semesters/{id}:
    get:
      tags:
        - Semesters
      summary: 학기 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 학기 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  semester:
                    $ref: '#/components/schemas/Semester'

    put:
      tags:
        - Semesters
      summary: 학기 수정 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SemesterInput'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    delete:
      tags:
        - Semesters
      summary: 학기 삭제 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Courses ==========
  /courses:
    get:
      tags:
        - Courses
      summary: 과목 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: semester_id
          schema:
            type: integer
        - in: query
          name: department_id
          schema:
            type: integer
        - in: query
          name: instructor_id
          schema:
            type: integer
        - in: query
          name: grade
          schema:
            type: integer
      responses:
        '200':
          description: 과목 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  courses:
                    type: array
                    items:
                      $ref: '#/components/schemas/Course'

    post:
      tags:
        - Courses
      summary: 과목 생성 (Admin/Instructor)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CourseInput'
      responses:
        '201':
          description: 과목 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /courses/{id}:
    get:
      tags:
        - Courses
      summary: 과목 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 과목 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  course:
                    $ref: '#/components/schemas/Course'

    put:
      tags:
        - Courses
      summary: 과목 수정 (Admin/Instructor)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CourseInput'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    delete:
      tags:
        - Courses
      summary: 과목 삭제 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Class Sessions ==========
  /sessions:
    get:
      tags:
        - Class Sessions
      summary: 강의 세션 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: course_id
          schema:
            type: integer
        - in: query
          name: week
          schema:
            type: integer
        - in: query
          name: date
          schema:
            type: string
            format: date
      responses:
        '200':
          description: 강의 세션 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessions:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassSession'

    post:
      tags:
        - Class Sessions
      summary: 강의 세션 생성 (Instructor)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClassSessionInput'
      responses:
        '201':
          description: 강의 세션 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /sessions/bulk:
    post:
      tags:
        - Class Sessions
      summary: 강의 세션 일괄 생성 (주차별 반복, 공휴일 제외)
      description: |
        학기 시작일부터 종료일까지 매주 같은 요일/시간에 강의 세션을 자동 생성합니다.
        2025년 2학기 공휴일(9월~12월)을 자동으로 제외합니다.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - course_id
                - day_of_week
                - start_time
                - end_time
              properties:
                course_id:
                  type: integer
                day_of_week:
                  type: integer
                  minimum: 0
                  maximum: 6
                  description: "0:일요일 ~ 6:토요일"
                start_time:
                  type: string
                  format: time
                end_time:
                  type: string
                  format: time
                room:
                  type: string
                exclude_dates:
                  type: array
                  items:
                    type: string
                    format: date
                  description: "추가로 제외할 날짜"
      responses:
        '201':
          description: 일괄 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  created_sessions:
                    type: integer

  /sessions/{id}:
    get:
      tags:
        - Class Sessions
      summary: 강의 세션 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 강의 세션 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  session:
                    $ref: '#/components/schemas/ClassSession'

    put:
      tags:
        - Class Sessions
      summary: 강의 세션 수정 (Instructor)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClassSessionInput'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    delete:
      tags:
        - Class Sessions
      summary: 강의 세션 삭제 (Instructor)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Enrollments ==========
  /enrollments:
    get:
      tags:
        - Enrollments
      summary: 수강신청 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: course_id
          schema:
            type: integer
        - in: query
          name: student_id
          schema:
            type: integer
      responses:
        '200':
          description: 수강신청 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  enrollments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Enrollment'

    post:
      tags:
        - Enrollments
      summary: 수강신청 생성
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnrollmentInput'
      responses:
        '201':
          description: 수강신청 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /enrollments/bulk-upload:
    post:
      tags:
        - Enrollments
      summary: 수강신청 엑셀 일괄 업로드 (Admin)
      description: |
        엑셀 파일로 수강신청 데이터를 일괄 업로드합니다.
        필수 컬럼: course_id, student_id
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: 일괄 업로드 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  created:
                    type: integer
                  failed:
                    type: integer

  /enrollments/{id}:
    delete:
      tags:
        - Enrollments
      summary: 수강신청 취소
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 수강 취소 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Attendance ==========
  /attendance/methods:
    get:
      tags:
        - Attendance
      summary: 출석 방식 목록 조회
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 출석 방식 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  methods:
                    type: array
                    items:
                      $ref: '#/components/schemas/AttendanceMethod'

  /attendance/status-codes:
    get:
      tags:
        - Attendance
      summary: 출석 상태 코드 목록
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 출석 상태 코드
          content:
            application/json:
              schema:
                type: object
                properties:
                  codes:
                    type: array
                    items:
                      $ref: '#/components/schemas/AttendanceStatusCode'

  /sessions/{session_id}/attendance:
    get:
      tags:
        - Attendance
      summary: 특정 세션의 출석 현황 조회 (실시간 대시보드)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: session_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 출석 현황
          content:
            application/json:
              schema:
                type: object
                properties:
                  session:
                    $ref: '#/components/schemas/ClassSession'
                  attendances:
                    type: array
                    items:
                      $ref: '#/components/schemas/Attendance'
                  statistics:
                    type: object
                    properties:
                      total:
                        type: integer
                      present:
                        type: integer
                      late:
                        type: integer
                      absent:
                        type: integer
                      excused:
                        type: integer
                      pending:
                        type: integer

  /sessions/{session_id}/attendance/open:
    post:
      tags:
        - Attendance
      summary: 출석 시작 (Instructor)
      description: 출석을 시작하고 출석 방식을 설정합니다.
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: session_id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - method_id
              properties:
                method_id:
                  type: integer
                  description: "출석 방식 ID"
                verification_code:
                  type: string
                  description: "인증번호 (인증번호 방식인 경우)"
      responses:
        '200':
          description: 출석 시작 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /sessions/{session_id}/attendance/close:
    post:
      tags:
        - Attendance
      summary: 출석 마감 (Instructor)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: session_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 출석 마감 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /attendance/check:
    post:
      tags:
        - Attendance
      summary: 출석 체크 (Student)
      description: 학생이 출석을 체크합니다. 전자출결 또는 인증번호 방식.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttendanceCheckRequest'
      responses:
        '200':
          description: 출석 체크 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /attendance/{id}:
    get:
      tags:
        - Attendance
      summary: 출석 기록 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 출석 기록
          content:
            application/json:
              schema:
                type: object
                properties:
                  attendance:
                    $ref: '#/components/schemas/Attendance'

    put:
      tags:
        - Attendance
      summary: 출석 상태 수정 (Instructor - 정정)
      description: 교원이 출석 상태를 정정합니다. 변경 이력이 감사 로그에 기록됩니다.
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttendanceUpdateRequest'
      responses:
        '200':
          description: 출석 정정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /students/{student_id}/attendance:
    get:
      tags:
        - Attendance
      summary: 학생의 전체 출석 현황 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: student_id
          required: true
          schema:
            type: integer
        - in: query
          name: course_id
          schema:
            type: integer
      responses:
        '200':
          description: 학생 출석 현황
          content:
            application/json:
              schema:
                type: object
                properties:
                  student:
                    $ref: '#/components/schemas/User'
                  attendances:
                    type: array
                    items:
                      $ref: '#/components/schemas/Attendance'
                  statistics:
                    type: object
                    properties:
                      total_sessions:
                        type: integer
                      present:
                        type: integer
                      late:
                        type: integer
                      absent:
                        type: integer
                      excused:
                        type: integer
                      absence_rate:
                        type: number
                        format: float

  # ========== Excuse Requests ==========
  /excuse-requests:
    get:
      tags:
        - Excuse Requests
      summary: 공결 신청 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: session_id
          schema:
            type: integer
        - in: query
          name: student_id
          schema:
            type: integer
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, approved, rejected]
      responses:
        '200':
          description: 공결 신청 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  excuse_requests:
                    type: array
                    items:
                      $ref: '#/components/schemas/ExcuseRequest'

    post:
      tags:
        - Excuse Requests
      summary: 공결 신청 (Student)
      description: 학생이 공결을 신청합니다. 증빙 파일 업로드 가능.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - session_id
                - reason_text
              properties:
                session_id:
                  type: integer
                reason_text:
                  type: string
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: 공결 신청 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /excuse-requests/{id}:
    get:
      tags:
        - Excuse Requests
      summary: 공결 신청 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 공결 신청 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  excuse_request:
                    $ref: '#/components/schemas/ExcuseRequest'

    put:
      tags:
        - Excuse Requests
      summary: 공결 신청 승인/반려 (Instructor)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExcuseRequestDecision'
      responses:
        '200':
          description: 처리 완료
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /excuse-requests/{id}/file:
    get:
      tags:
        - Excuse Requests
      summary: 공결 증빙 파일 다운로드
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 파일 다운로드
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  # ========== Attendance Appeals ==========
  /attendance-appeals:
    get:
      tags:
        - Attendance Appeals
      summary: 이의제기 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: attendance_id
          schema:
            type: integer
        - in: query
          name: student_id
          schema:
            type: integer
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, approved, rejected]
      responses:
        '200':
          description: 이의제기 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  appeals:
                    type: array
                    items:
                      $ref: '#/components/schemas/AttendanceAppeal'

    post:
      tags:
        - Attendance Appeals
      summary: 출석 이의제기 (Student)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttendanceAppealInput'
      responses:
        '201':
          description: 이의제기 접수 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /attendance-appeals/{id}:
    get:
      tags:
        - Attendance Appeals
      summary: 이의제기 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 이의제기 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  appeal:
                    $ref: '#/components/schemas/AttendanceAppeal'

    put:
      tags:
        - Attendance Appeals
      summary: 이의제기 처리 (Instructor)
      description: 교원이 이의제기를 검토하고 승인/반려합니다. 승인 시 출석 데이터가 변경되고 감사 로그에 기록됩니다.
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [approved, rejected]
                teacher_comment:
                  type: string
      responses:
        '200':
          description: 처리 완료
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Messages ==========
  /messages:
    get:
      tags:
        - Messages
      summary: 메시지 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: course_id
          schema:
            type: integer
        - in: query
          name: is_read
          schema:
            type: boolean
      responses:
        '200':
          description: 메시지 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  messages:
                    type: array
                    items:
                      $ref: '#/components/schemas/Message'

    post:
      tags:
        - Messages
      summary: 메시지 발송
      description: |
        개인 메시지 또는 강의 전체 공지를 발송합니다.
        - 개인 메시지: to_user_id 지정
        - 강의 전체 공지: course_id 지정 (Instructor만 가능)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageInput'
      responses:
        '201':
          description: 메시지 발송 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /messages/{id}:
    get:
      tags:
        - Messages
      summary: 메시지 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 메시지 정보
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    $ref: '#/components/schemas/Message'

    patch:
      tags:
        - Messages
      summary: 메시지 읽음 처리
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 읽음 처리 완료
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Notifications ==========
  /notifications:
    get:
      tags:
        - Notifications
      summary: 알림 목록 조회
      description: |
        로그인한 사용자의 알림 목록을 조회합니다.
        실시간 푸시 알림을 위해 WebSocket 또는 Server-Sent Events 사용 권장.
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: is_read
          schema:
            type: boolean
        - in: query
          name: type
          schema:
            type: string
            enum: [attendance_open, attendance_close, excuse_result, course_announcement, poll_created, absence_warning]
      responses:
        '200':
          description: 알림 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  notifications:
                    type: array
                    items:
                      $ref: '#/components/schemas/Notification'

  /notifications/{id}/read:
    patch:
      tags:
        - Notifications
      summary: 알림 읽음 처리
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 읽음 처리 완료
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /notifications/read-all:
    patch:
      tags:
        - Notifications
      summary: 모든 알림 읽음 처리
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 모든 알림 읽음 처리 완료
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Polls ==========
  /polls:
    get:
      tags:
        - Polls
      summary: 투표 목록 조회
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: course_id
          schema:
            type: integer
        - in: query
          name: status
          schema:
            type: string
            enum: [active, closed]
      responses:
        '200':
          description: 투표 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  polls:
                    type: array
                    items:
                      $ref: '#/components/schemas/Poll'

    post:
      tags:
        - Polls
      summary: 투표 생성 (Instructor - 공강 투표)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PollInput'
      responses:
        '201':
          description: 투표 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /polls/{id}:
    get:
      tags:
        - Polls
      summary: 투표 상세 조회
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 투표 정보 및 결과
          content:
            application/json:
              schema:
                type: object
                properties:
                  poll:
                    $ref: '#/components/schemas/Poll'
                  votes:
                    type: array
                    items:
                      $ref: '#/components/schemas/PollVote'
                  result:
                    type: object
                    properties:
                      total:
                        type: integer
                      yes:
                        type: integer
                      no:
                        type: integer

  /polls/{id}/vote:
    post:
      tags:
        - Polls
      summary: 투표하기 (Student)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PollVoteInput'
      responses:
        '201':
          description: 투표 완료
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /polls/{id}/close:
    post:
      tags:
        - Polls
      summary: 투표 마감 (Instructor)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 투표 마감 완료
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # ========== Audit Logs ==========
  /audit-logs:
    get:
      tags:
        - Audit Logs
      summary: 감사 로그 조회 (Admin)
      description: |
        시스템의 모든 중요 이벤트를 조회합니다.
        - 출석 변경
        - 공결 승인/반려
        - 이의제기 처리
        - 투표 결과
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: user_id
          schema:
            type: integer
        - in: query
          name: action
          schema:
            type: string
        - in: query
          name: target_type
          schema:
            type: string
        - in: query
          name: start_date
          schema:
            type: string
            format: date-time
        - in: query
          name: end_date
          schema:
            type: string
            format: date-time
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: 감사 로그 목록
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'

  /audit-logs/{id}:
    get:
      tags:
        - Audit Logs
      summary: 감사 로그 상세 조회 (Admin)
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 감사 로그 상세
          content:
            application/json:
              schema:
                type: object
                properties:
                  log:
                    $ref: '#/components/schemas/AuditLog'

  # ========== Reports ==========
  /reports/system-status:
    get:
      tags:
        - Reports
      summary: 시스템 상태 리포트 (Admin)
      security:
        - cookieAuth: []
      responses:
        '200':
          description: 시스템 상태
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_users:
                    type: integer
                  total_courses:
                    type: integer
                  total_sessions:
                    type: integer
                  active_sessions_today:
                    type: integer
                  total_attendances:
                    type: integer
                  pending_excuse_requests:
                    type: integer
                  pending_appeals:
                    type: integer

  /reports/attendance-statistics:
    get:
      tags:
        - Reports
      summary: 출석 통계 리포트 (Admin/Instructor)
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: course_id
          schema:
            type: integer
        - in: query
          name: semester_id
          schema:
            type: integer
        - in: query
          name: department_id
          schema:
            type: integer
      responses:
        '200':
          description: 출석 통계
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_students:
                    type: integer
                  total_sessions:
                    type: integer
                  attendance_rate:
                    type: number
                    format: float
                  by_status:
                    type: object
                    properties:
                      present:
                        type: integer
                      late:
                        type: integer
                      absent:
                        type: integer
                      excused:
                        type: integer
                  at_risk_students:
                    type: array
                    items:
                      type: object
                      properties:
                        student_id:
                          type: integer
                        student_name:
                          type: string
                        absence_count:
                          type: integer

  /reports/course/{course_id}/export:
    get:
      tags:
        - Reports
      summary: 강의별 출석 데이터 엑셀 내보내기
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: course_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 엑셀 파일 다운로드
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

security:
  - cookieAuth: []
